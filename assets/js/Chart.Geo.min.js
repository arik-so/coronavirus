!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("chart.js")):"function"==typeof define&&define.amd?define(["exports","chart.js"],n):n((t=t||self).ChartGeo={},t.Chart)}(this,function(t,n){"use strict";function e(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function r(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),e.push.apply(e,r)}return e}function i(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?r(i,!0).forEach(function(n){e(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(i).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function o(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var e=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(e.push(u.value),!n||e.length!==n);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(){return new a}function a(){this.reset()}a.prototype={constructor:a,reset:function(){this.s=this.t=0},add:function(t){l(c,t,this.t),l(this,c.s,this.s),this.s?this.t+=c.t:this.s=c.t},valueOf:function(){return this.s}};var c=new a;function l(t,n,e){var r=t.s=n+e,i=r-n,o=r-i;t.t=n-o+(e-i)}var s=1e-6,f=1e-12,h=Math.PI,p=h/2,g=h/4,d=2*h,v=180/h,y=h/180,m=Math.abs,E=Math.atan,b=Math.atan2,S=Math.cos,x=Math.ceil,M=Math.exp,_=Math.log,w=Math.pow,P=Math.sin,j=Math.sign||function(t){return t>0?1:t<0?-1:0},C=Math.sqrt,N=Math.tan;function O(t){return t>1?0:t<-1?h:Math.acos(t)}function A(t){return t>1?p:t<-1?-p:Math.asin(t)}function k(){}function G(t,n){t&&D.hasOwnProperty(t.type)&&D[t.type](t,n)}var F={Feature:function(t,n){G(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,i=e.length;++r<i;)G(e[r].geometry,n)}},D={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)t=e[r],n.point(t[0],t[1],t[2])},LineString:function(t,n){B(t.coordinates,n,0)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)B(e[r],n,0)},Polygon:function(t,n){I(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)I(e[r],n)},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,i=e.length;++r<i;)G(e[r],n)}};function B(t,n,e){var r,i=-1,o=t.length-e;for(n.lineStart();++i<o;)r=t[i],n.point(r[0],r[1],r[2]);n.lineEnd()}function I(t,n){var e=-1,r=t.length;for(n.polygonStart();++e<r;)B(t[e],n,1);n.polygonEnd()}function L(t,n){t&&F.hasOwnProperty(t.type)?F[t.type](t,n):G(t,n)}u(),u();function R(t){return[b(t[1],t[0]),A(t[2])]}function W(t){var n=t[0],e=t[1],r=S(e);return[r*S(n),r*P(n),P(e)]}function z(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function q(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function T(t,n){t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}function H(t,n){return[t[0]*n,t[1]*n,t[2]*n]}function U(t){var n=C(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=n,t[1]/=n,t[2]/=n}u();function X(t,n){function e(e,r){return e=t(e,r),n(e[0],e[1])}return t.invert&&n.invert&&(e.invert=function(e,r){return(e=n.invert(e,r))&&t.invert(e[0],e[1])}),e}function Y(t,n){return[m(t)>h?t+Math.round(-t/d)*d:t,n]}function Z(t,n,e){return(t%=d)?n||e?X(K(t),Q(n,e)):K(t):n||e?Q(n,e):Y}function J(t){return function(n,e){return[(n+=t)>h?n-d:n<-h?n+d:n,e]}}function K(t){var n=J(t);return n.invert=J(-t),n}function Q(t,n){var e=S(t),r=P(t),i=S(n),o=P(n);function u(t,n){var u=S(n),a=S(t)*u,c=P(t)*u,l=P(n),s=l*e+a*r;return[b(c*i-s*o,a*e-l*r),A(s*i+c*o)]}return u.invert=function(t,n){var u=S(n),a=S(t)*u,c=P(t)*u,l=P(n),s=l*i-c*o;return[b(c*i+l*o,a*e+s*r),A(s*e-a*r)]},u}function V(t,n){(n=W(n))[0]-=t,U(n);var e=O(-n[1]);return((-n[2]<0?-e:e)+d-s)%d}function $(){var t,n=[];return{point:function(n,e){t.push([n,e])},lineStart:function(){n.push(t=[])},lineEnd:k,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function tt(t,n){return m(t[0]-n[0])<s&&m(t[1]-n[1])<s}function nt(t,n,e,r){this.x=t,this.z=n,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function et(t,n,e,r,i){var o,u,a=[],c=[];if(t.forEach(function(t){if(!((n=t.length-1)<=0)){var n,e,r=t[0],u=t[n];if(tt(r,u)){for(i.lineStart(),o=0;o<n;++o)i.point((r=t[o])[0],r[1]);i.lineEnd()}else a.push(e=new nt(r,t,null,!0)),c.push(e.o=new nt(r,null,e,!1)),a.push(e=new nt(u,t,null,!1)),c.push(e.o=new nt(u,null,e,!0))}}),a.length){for(c.sort(n),rt(a),rt(c),o=0,u=c.length;o<u;++o)c[o].e=e=!e;for(var l,s,f=a[0];;){for(var h=f,p=!0;h.v;)if((h=h.n)===f)return;l=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(p)for(o=0,u=l.length;o<u;++o)i.point((s=l[o])[0],s[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(p)for(l=h.p.z,o=l.length-1;o>=0;--o)i.point((s=l[o])[0],s[1]);else r(h.x,h.p.x,-1,i);h=h.p}l=(h=h.o).z,p=!p}while(!h.v);i.lineEnd()}}}function rt(t){if(n=t.length){for(var n,e,r=0,i=t[0];++r<n;)i.n=e=t[r],e.p=i,i=e;i.n=e=t[0],e.p=i}}Y.invert=Y;var it=u();function ot(t){return m(t[0])<=h?t[0]:j(t[0])*((m(t[0])+h)%d-h)}function ut(t,n){var e=ot(n),r=n[1],i=P(r),o=[P(e),-S(e),0],u=0,a=0;it.reset(),1===i?r=p+s:-1===i&&(r=-p-s);for(var c=0,l=t.length;c<l;++c)if(v=(f=t[c]).length)for(var f,v,y=f[v-1],m=ot(y),E=y[1]/2+g,x=P(E),M=S(E),_=0;_<v;++_,m=j,x=N,M=O,y=w){var w=f[_],j=ot(w),C=w[1]/2+g,N=P(C),O=S(C),k=j-m,G=k>=0?1:-1,F=G*k,D=F>h,B=x*N;if(it.add(b(B*G*P(F),M*O+B*S(F))),u+=D?k+G*d:k,D^m>=e^j>=e){var I=q(W(y),W(w));U(I);var L=q(o,I);U(L);var R=(D^k>=0?-1:1)*A(L[2]);(r>R||r===R&&(I[0]||I[1]))&&(a+=D^k>=0?1:-1)}}return(u<-s||u<s&&it<-s)^1&a}function at(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}var ct,lt;1===(ct=at).length&&(lt=ct,ct=function(t,n){return at(lt(t),n)});function st(t,n,e){t=+t,n=+n,e=(i=arguments.length)<2?(n=t,t=0,1):i<3?1:+e;for(var r=-1,i=0|Math.max(0,Math.ceil((n-t)/e)),o=new Array(i);++r<i;)o[r]=t+r*e;return o}function ft(t){for(var n,e,r,i=t.length,o=-1,u=0;++o<i;)u+=t[o].length;for(e=new Array(u);--i>=0;)for(n=(r=t[i]).length;--n>=0;)e[--u]=r[n];return e}function ht(t,n,e,r){return function(i){var o,u,a,c=n(i),l=$(),s=n(l),f=!1,h={point:p,lineStart:d,lineEnd:v,polygonStart:function(){h.point=y,h.lineStart=m,h.lineEnd=E,u=[],o=[]},polygonEnd:function(){h.point=p,h.lineStart=d,h.lineEnd=v,u=ft(u);var t=ut(o,r);u.length?(f||(i.polygonStart(),f=!0),et(u,gt,t,e,i)):t&&(f||(i.polygonStart(),f=!0),i.lineStart(),e(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),u=o=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function p(n,e){t(n,e)&&i.point(n,e)}function g(t,n){c.point(t,n)}function d(){h.point=g,c.lineStart()}function v(){h.point=p,c.lineEnd()}function y(t,n){a.push([t,n]),s.point(t,n)}function m(){s.lineStart(),a=[]}function E(){y(a[0][0],a[0][1]),s.lineEnd();var t,n,e,r,c=s.clean(),h=l.result(),p=h.length;if(a.pop(),o.push(a),a=null,p)if(1&c){if((n=(e=h[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),t=0;t<n;++t)i.point((r=e[t])[0],r[1]);i.lineEnd()}}else p>1&&2&c&&h.push(h.pop().concat(h.shift())),u.push(h.filter(pt))}return h}}function pt(t){return t.length>1}function gt(t,n){return((t=t.x)[0]<0?t[1]-p-s:p-t[1])-((n=n.x)[0]<0?n[1]-p-s:p-n[1])}var dt=ht(function(){return!0},function(t){var n,e=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),n=1},point:function(o,u){var a=o>0?h:-h,c=m(o-e);m(c-h)<s?(t.point(e,r=(r+u)/2>0?p:-p),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(o,r),n=0):i!==a&&c>=h&&(m(e-i)<s&&(e-=i*s),m(o-a)<s&&(o-=a*s),r=function(t,n,e,r){var i,o,u=P(t-e);return m(u)>s?E((P(n)*(o=S(r))*P(e)-P(r)*(i=S(n))*P(t))/(i*o*u)):(n+r)/2}(e,r,o,u),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),n=0),t.point(e=o,r=u),i=a},lineEnd:function(){t.lineEnd(),e=r=NaN},clean:function(){return 2-n}}},function(t,n,e,r){var i;if(null==t)i=e*p,r.point(-h,i),r.point(0,i),r.point(h,i),r.point(h,0),r.point(h,-i),r.point(0,-i),r.point(-h,-i),r.point(-h,0),r.point(-h,i);else if(m(t[0]-n[0])>s){var o=t[0]<n[0]?h:-h;i=e*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(n[0],n[1])},[-h,-p]);function vt(t){var n=S(t),e=6*y,r=n>0,i=m(n)>s;function o(t,e){return S(t)*S(e)>n}function u(t,e,r){var i=[1,0,0],o=q(W(t),W(e)),u=z(o,o),a=o[0],c=u-a*a;if(!c)return!r&&t;var l=n*u/c,f=-n*a/c,p=q(i,o),g=H(i,l);T(g,H(o,f));var d=p,v=z(g,d),y=z(d,d),E=v*v-y*(z(g,g)-1);if(!(E<0)){var b=C(E),S=H(d,(-v-b)/y);if(T(S,g),S=R(S),!r)return S;var x,M=t[0],_=e[0],w=t[1],P=e[1];_<M&&(x=M,M=_,_=x);var j=_-M,N=m(j-h)<s;if(!N&&P<w&&(x=w,w=P,P=x),N||j<s?N?w+P>0^S[1]<(m(S[0]-M)<s?w:P):w<=S[1]&&S[1]<=P:j>h^(M<=S[0]&&S[0]<=_)){var O=H(d,(-v+b)/y);return T(O,g),[S,R(O)]}}}function a(n,e){var i=r?t:h-t,o=0;return n<-i?o|=1:n>i&&(o|=2),e<-i?o|=4:e>i&&(o|=8),o}return ht(o,function(t){var n,e,c,l,f;return{lineStart:function(){l=c=!1,f=1},point:function(p,g){var d,v=[p,g],y=o(p,g),m=r?y?0:a(p,g):y?a(p+(p<0?h:-h),g):0;if(!n&&(l=c=y)&&t.lineStart(),y!==c&&(!(d=u(n,v))||tt(n,d)||tt(v,d))&&(v[0]+=s,v[1]+=s,y=o(v[0],v[1])),y!==c)f=0,y?(t.lineStart(),d=u(v,n),t.point(d[0],d[1])):(d=u(n,v),t.point(d[0],d[1]),t.lineEnd()),n=d;else if(i&&n&&r^y){var E;m&e||!(E=u(v,n,!0))||(f=0,r?(t.lineStart(),t.point(E[0][0],E[0][1]),t.point(E[1][0],E[1][1]),t.lineEnd()):(t.point(E[1][0],E[1][1]),t.lineEnd(),t.lineStart(),t.point(E[0][0],E[0][1])))}!y||n&&tt(n,v)||t.point(v[0],v[1]),n=v,c=y,e=m},lineEnd:function(){c&&t.lineEnd(),n=null},clean:function(){return f|(l&&c)<<1}}},function(n,r,i,o){!function(t,n,e,r,i,o){if(e){var u=S(n),a=P(n),c=r*e;null==i?(i=n+r*d,o=n-c/2):(i=V(u,i),o=V(u,o),(r>0?i<o:i>o)&&(i+=r*d));for(var l,s=i;r>0?s>o:s<o;s-=c)l=R([u,-a*S(s),-a*P(s)]),t.point(l[0],l[1])}}(o,t,e,i,n,r)},r?[0,-t]:[-h,t-h])}var yt=1e9,mt=-yt;function Et(t,n,e,r){function i(i,o){return t<=i&&i<=e&&n<=o&&o<=r}function o(i,o,a,l){var s=0,f=0;if(null==i||(s=u(i,a))!==(f=u(o,a))||c(i,o)<0^a>0)do{l.point(0===s||3===s?t:e,s>1?r:n)}while((s=(s+a+4)%4)!==f);else l.point(o[0],o[1])}function u(r,i){return m(r[0]-t)<s?i>0?0:3:m(r[0]-e)<s?i>0?2:1:m(r[1]-n)<s?i>0?1:0:i>0?3:2}function a(t,n){return c(t.x,n.x)}function c(t,n){var e=u(t,1),r=u(n,1);return e!==r?e-r:0===e?n[1]-t[1]:1===e?t[0]-n[0]:2===e?t[1]-n[1]:n[0]-t[0]}return function(u){var c,l,s,f,h,p,g,d,v,y,m,E=u,b=$(),S={point:x,lineStart:function(){S.point=M,l&&l.push(s=[]);y=!0,v=!1,g=d=NaN},lineEnd:function(){c&&(M(f,h),p&&v&&b.rejoin(),c.push(b.result()));S.point=x,v&&E.lineEnd()},polygonStart:function(){E=b,c=[],l=[],m=!0},polygonEnd:function(){var n=function(){for(var n=0,e=0,i=l.length;e<i;++e)for(var o,u,a=l[e],c=1,s=a.length,f=a[0],h=f[0],p=f[1];c<s;++c)o=h,u=p,f=a[c],h=f[0],p=f[1],u<=r?p>r&&(h-o)*(r-u)>(p-u)*(t-o)&&++n:p<=r&&(h-o)*(r-u)<(p-u)*(t-o)&&--n;return n}(),e=m&&n,i=(c=ft(c)).length;(e||i)&&(u.polygonStart(),e&&(u.lineStart(),o(null,null,1,u),u.lineEnd()),i&&et(c,a,n,o,u),u.polygonEnd());E=u,c=l=s=null}};function x(t,n){i(t,n)&&E.point(t,n)}function M(o,u){var a=i(o,u);if(l&&s.push([o,u]),y)f=o,h=u,p=a,y=!1,a&&(E.lineStart(),E.point(o,u));else if(a&&v)E.point(o,u);else{var c=[g=Math.max(mt,Math.min(yt,g)),d=Math.max(mt,Math.min(yt,d))],b=[o=Math.max(mt,Math.min(yt,o)),u=Math.max(mt,Math.min(yt,u))];!function(t,n,e,r,i,o){var u,a=t[0],c=t[1],l=0,s=1,f=n[0]-a,h=n[1]-c;if(u=e-a,f||!(u>0)){if(u/=f,f<0){if(u<l)return;u<s&&(s=u)}else if(f>0){if(u>s)return;u>l&&(l=u)}if(u=i-a,f||!(u<0)){if(u/=f,f<0){if(u>s)return;u>l&&(l=u)}else if(f>0){if(u<l)return;u<s&&(s=u)}if(u=r-c,h||!(u>0)){if(u/=h,h<0){if(u<l)return;u<s&&(s=u)}else if(h>0){if(u>s)return;u>l&&(l=u)}if(u=o-c,h||!(u<0)){if(u/=h,h<0){if(u>s)return;u>l&&(l=u)}else if(h>0){if(u<l)return;u<s&&(s=u)}return l>0&&(t[0]=a+l*f,t[1]=c+l*h),s<1&&(n[0]=a+s*f,n[1]=c+s*h),!0}}}}}(c,b,t,n,e,r)?a&&(E.lineStart(),E.point(o,u),m=!1):(v||(E.lineStart(),E.point(c[0],c[1])),E.point(b[0],b[1]),a||E.lineEnd(),m=!1)}g=o,d=u,v=a}return S}}var bt,St,xt,Mt=u(),_t={sphere:k,point:k,lineStart:function(){_t.point=Pt,_t.lineEnd=wt},lineEnd:k,polygonStart:k,polygonEnd:k};function wt(){_t.point=_t.lineEnd=k}function Pt(t,n){bt=t*=y,St=P(n*=y),xt=S(n),_t.point=jt}function jt(t,n){t*=y;var e=P(n*=y),r=S(n),i=m(t-bt),o=S(i),u=r*P(i),a=xt*e-St*r*o,c=St*e+xt*r*o;Mt.add(b(C(u*u+a*a),c)),bt=t,St=e,xt=r}var Ct=[null,null],Nt={type:"LineString",coordinates:Ct};function Ot(t,n){return Ct[0]=t,Ct[1]=n,function(t){return Mt.reset(),L(t,_t),+Mt}(Nt)}var At={Feature:function(t,n){return Gt(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,i=e.length;++r<i;)if(Gt(e[r].geometry,n))return!0;return!1}},kt={Sphere:function(){return!0},Point:function(t,n){return Ft(t.coordinates,n)},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)if(Ft(e[r],n))return!0;return!1},LineString:function(t,n){return Dt(t.coordinates,n)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)if(Dt(e[r],n))return!0;return!1},Polygon:function(t,n){return Bt(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)if(Bt(e[r],n))return!0;return!1},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,i=e.length;++r<i;)if(Gt(e[r],n))return!0;return!1}};function Gt(t,n){return!(!t||!kt.hasOwnProperty(t.type))&&kt[t.type](t,n)}function Ft(t,n){return 0===Ot(t,n)}function Dt(t,n){for(var e,r,i,o=0,u=t.length;o<u;o++){if(0===(r=Ot(t[o],n)))return!0;if(o>0&&(i=Ot(t[o],t[o-1]))>0&&e<=i&&r<=i&&(e+r-i)*(1-Math.pow((e-r)/i,2))<f*i)return!0;e=r}return!1}function Bt(t,n){return!!ut(t.map(It),Lt(n))}function It(t){return(t=t.map(Lt)).pop(),t}function Lt(t){return[t[0]*y,t[1]*y]}function Rt(t,n,e){var r=st(t,n-s,e).concat(n);return function(t){return r.map(function(n){return[t,n]})}}function Wt(t,n,e){var r=st(t,n-s,e).concat(n);return function(t){return r.map(function(n){return[n,t]})}}function zt(){var t,n,e,r,i,o,u,a,c,l,f,h,p=10,g=p,d=90,v=360,y=2.5;function E(){return{type:"MultiLineString",coordinates:b()}}function b(){return st(x(r/d)*d,e,d).map(f).concat(st(x(a/v)*v,u,v).map(h)).concat(st(x(n/p)*p,t,p).filter(function(t){return m(t%d)>s}).map(c)).concat(st(x(o/g)*g,i,g).filter(function(t){return m(t%v)>s}).map(l))}return E.lines=function(){return b().map(function(t){return{type:"LineString",coordinates:t}})},E.outline=function(){return{type:"Polygon",coordinates:[f(r).concat(h(u).slice(1),f(e).reverse().slice(1),h(a).reverse().slice(1))]}},E.extent=function(t){return arguments.length?E.extentMajor(t).extentMinor(t):E.extentMinor()},E.extentMajor=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],a=+t[0][1],u=+t[1][1],r>e&&(t=r,r=e,e=t),a>u&&(t=a,a=u,u=t),E.precision(y)):[[r,a],[e,u]]},E.extentMinor=function(e){return arguments.length?(n=+e[0][0],t=+e[1][0],o=+e[0][1],i=+e[1][1],n>t&&(e=n,n=t,t=e),o>i&&(e=o,o=i,i=e),E.precision(y)):[[n,o],[t,i]]},E.step=function(t){return arguments.length?E.stepMajor(t).stepMinor(t):E.stepMinor()},E.stepMajor=function(t){return arguments.length?(d=+t[0],v=+t[1],E):[d,v]},E.stepMinor=function(t){return arguments.length?(p=+t[0],g=+t[1],E):[p,g]},E.precision=function(s){return arguments.length?(y=+s,c=Rt(o,i,90),l=Wt(n,t,y),f=Rt(a,u,90),h=Wt(r,e,y),E):y},E.extentMajor([[-180,-90+s],[180,90-s]]).extentMinor([[-180,-80-s],[180,80+s]])}function qt(t){return t}var Tt,Ht,Ut,Xt,Yt=u(),Zt=u(),Jt={point:k,lineStart:k,lineEnd:k,polygonStart:function(){Jt.lineStart=Kt,Jt.lineEnd=$t},polygonEnd:function(){Jt.lineStart=Jt.lineEnd=Jt.point=k,Yt.add(m(Zt)),Zt.reset()},result:function(){var t=Yt/2;return Yt.reset(),t}};function Kt(){Jt.point=Qt}function Qt(t,n){Jt.point=Vt,Tt=Ut=t,Ht=Xt=n}function Vt(t,n){Zt.add(Xt*t-Ut*n),Ut=t,Xt=n}function $t(){Vt(Tt,Ht)}var tn=1/0,nn=tn,en=-tn,rn=en,on={point:function(t,n){t<tn&&(tn=t);t>en&&(en=t);n<nn&&(nn=n);n>rn&&(rn=n)},lineStart:k,lineEnd:k,polygonStart:k,polygonEnd:k,result:function(){var t=[[tn,nn],[en,rn]];return en=rn=-(nn=tn=1/0),t}};var un,an,cn,ln,sn=0,fn=0,hn=0,pn=0,gn=0,dn=0,vn=0,yn=0,mn=0,En={point:bn,lineStart:Sn,lineEnd:_n,polygonStart:function(){En.lineStart=wn,En.lineEnd=Pn},polygonEnd:function(){En.point=bn,En.lineStart=Sn,En.lineEnd=_n},result:function(){var t=mn?[vn/mn,yn/mn]:dn?[pn/dn,gn/dn]:hn?[sn/hn,fn/hn]:[NaN,NaN];return sn=fn=hn=pn=gn=dn=vn=yn=mn=0,t}};function bn(t,n){sn+=t,fn+=n,++hn}function Sn(){En.point=xn}function xn(t,n){En.point=Mn,bn(cn=t,ln=n)}function Mn(t,n){var e=t-cn,r=n-ln,i=C(e*e+r*r);pn+=i*(cn+t)/2,gn+=i*(ln+n)/2,dn+=i,bn(cn=t,ln=n)}function _n(){En.point=bn}function wn(){En.point=jn}function Pn(){Cn(un,an)}function jn(t,n){En.point=Cn,bn(un=cn=t,an=ln=n)}function Cn(t,n){var e=t-cn,r=n-ln,i=C(e*e+r*r);pn+=i*(cn+t)/2,gn+=i*(ln+n)/2,dn+=i,vn+=(i=ln*t-cn*n)*(cn+t),yn+=i*(ln+n),mn+=3*i,bn(cn=t,ln=n)}function Nn(t){this._context=t}Nn.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._context.moveTo(t,n),this._point=1;break;case 1:this._context.lineTo(t,n);break;default:this._context.moveTo(t+this._radius,n),this._context.arc(t,n,this._radius,0,d)}},result:k};var On,An,kn,Gn,Fn,Dn=u(),Bn={point:k,lineStart:function(){Bn.point=In},lineEnd:function(){On&&Ln(An,kn),Bn.point=k},polygonStart:function(){On=!0},polygonEnd:function(){On=null},result:function(){var t=+Dn;return Dn.reset(),t}};function In(t,n){Bn.point=Ln,An=Gn=t,kn=Fn=n}function Ln(t,n){Gn-=t,Fn-=n,Dn.add(C(Gn*Gn+Fn*Fn)),Gn=t,Fn=n}function Rn(){this._string=[]}function Wn(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function zn(t,n){var e,r,i=4.5;function o(t){return t&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),L(t,e(r))),r.result()}return o.area=function(t){return L(t,e(Jt)),Jt.result()},o.measure=function(t){return L(t,e(Bn)),Bn.result()},o.bounds=function(t){return L(t,e(on)),on.result()},o.centroid=function(t){return L(t,e(En)),En.result()},o.projection=function(n){return arguments.length?(e=null==n?(t=null,qt):(t=n).stream,o):t},o.context=function(t){return arguments.length?(r=null==t?(n=null,new Rn):new Nn(n=t),"function"!=typeof i&&r.pointRadius(i),o):n},o.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(r.pointRadius(+t),+t),o):i},o.projection(t).context(n)}function qn(t){return function(n){var e=new Tn;for(var r in t)e[r]=t[r];return e.stream=n,e}}function Tn(){}function Hn(t,n,e){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),L(e,t.stream(on)),n(on.result()),null!=r&&t.clipExtent(r),t}function Un(t,n,e){return Hn(t,function(e){var r=n[1][0]-n[0][0],i=n[1][1]-n[0][1],o=Math.min(r/(e[1][0]-e[0][0]),i/(e[1][1]-e[0][1])),u=+n[0][0]+(r-o*(e[1][0]+e[0][0]))/2,a=+n[0][1]+(i-o*(e[1][1]+e[0][1]))/2;t.scale(150*o).translate([u,a])},e)}function Xn(t,n,e){return Un(t,[[0,0],n],e)}function Yn(t,n,e){return Hn(t,function(e){var r=+n,i=r/(e[1][0]-e[0][0]),o=(r-i*(e[1][0]+e[0][0]))/2,u=-i*e[0][1];t.scale(150*i).translate([o,u])},e)}function Zn(t,n,e){return Hn(t,function(e){var r=+n,i=r/(e[1][1]-e[0][1]),o=-i*e[0][0],u=(r-i*(e[1][1]+e[0][1]))/2;t.scale(150*i).translate([o,u])},e)}Rn.prototype={_radius:4.5,_circle:Wn(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._string.push("M",t,",",n),this._point=1;break;case 1:this._string.push("L",t,",",n);break;default:null==this._circle&&(this._circle=Wn(this._radius)),this._string.push("M",t,",",n,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}},Tn.prototype={constructor:Tn,point:function(t,n){this.stream.point(t,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Jn=16,Kn=S(30*y);function Qn(t,n){return+n?function(t,n){function e(r,i,o,u,a,c,l,f,h,p,g,d,v,y){var E=l-r,S=f-i,x=E*E+S*S;if(x>4*n&&v--){var M=u+p,_=a+g,w=c+d,P=C(M*M+_*_+w*w),j=A(w/=P),N=m(m(w)-1)<s||m(o-h)<s?(o+h)/2:b(_,M),O=t(N,j),k=O[0],G=O[1],F=k-r,D=G-i,B=S*F-E*D;(B*B/x>n||m((E*F+S*D)/x-.5)>.3||u*p+a*g+c*d<Kn)&&(e(r,i,o,u,a,c,k,G,N,M/=P,_/=P,w,v,y),y.point(k,G),e(k,G,N,M,_,w,l,f,h,p,g,d,v,y))}}return function(n){var r,i,o,u,a,c,l,s,f,h,p,g,d={point:v,lineStart:y,lineEnd:E,polygonStart:function(){n.polygonStart(),d.lineStart=b},polygonEnd:function(){n.polygonEnd(),d.lineStart=y}};function v(e,r){e=t(e,r),n.point(e[0],e[1])}function y(){s=NaN,d.point=m,n.lineStart()}function m(r,i){var o=W([r,i]),u=t(r,i);e(s,f,l,h,p,g,s=u[0],f=u[1],l=r,h=o[0],p=o[1],g=o[2],Jn,n),n.point(s,f)}function E(){d.point=v,n.lineEnd()}function b(){y(),d.point=S,d.lineEnd=x}function S(t,n){m(r=t,n),i=s,o=f,u=h,a=p,c=g,d.point=m}function x(){e(s,f,l,h,p,g,i,o,r,u,a,c,Jn,n),d.lineEnd=E,E()}return d}}(t,n):function(t){return qn({point:function(n,e){n=t(n,e),this.stream.point(n[0],n[1])}})}(t)}var Vn=qn({point:function(t,n){this.stream.point(t*y,n*y)}});function $n(t,n,e,r){var i=S(r),o=P(r),u=i*t,a=o*t,c=i/t,l=o/t,s=(o*e-i*n)/t,f=(o*n+i*e)/t;function h(t,r){return[u*t-a*r+n,e-a*t-u*r]}return h.invert=function(t,n){return[c*t-l*n+s,f-l*t-c*n]},h}function te(t){return ne(function(){return t})()}function ne(t){var n,e,r,i,o,u,a,c,l,s,f=150,h=480,p=250,g=0,d=0,m=0,E=0,b=0,S=0,x=null,M=dt,_=null,w=qt,P=.5;function j(t){return c(t[0]*y,t[1]*y)}function N(t){return(t=c.invert(t[0],t[1]))&&[t[0]*v,t[1]*v]}function O(){var t=$n(f,0,0,S).apply(null,n(g,d)),r=(S?$n:function(t,n,e){function r(r,i){return[n+t*r,e-t*i]}return r.invert=function(r,i){return[(r-n)/t,(e-i)/t]},r})(f,h-t[0],p-t[1],S);return e=Z(m,E,b),a=X(n,r),c=X(e,a),u=Qn(a,P),A()}function A(){return l=s=null,j}return j.stream=function(t){return l&&s===t?l:l=Vn(function(t){return qn({point:function(n,e){var r=t(n,e);return this.stream.point(r[0],r[1])}})}(e)(M(u(w(s=t)))))},j.preclip=function(t){return arguments.length?(M=t,x=void 0,A()):M},j.postclip=function(t){return arguments.length?(w=t,_=r=i=o=null,A()):w},j.clipAngle=function(t){return arguments.length?(M=+t?vt(x=t*y):(x=null,dt),A()):x*v},j.clipExtent=function(t){return arguments.length?(w=null==t?(_=r=i=o=null,qt):Et(_=+t[0][0],r=+t[0][1],i=+t[1][0],o=+t[1][1]),A()):null==_?null:[[_,r],[i,o]]},j.scale=function(t){return arguments.length?(f=+t,O()):f},j.translate=function(t){return arguments.length?(h=+t[0],p=+t[1],O()):[h,p]},j.center=function(t){return arguments.length?(g=t[0]%360*y,d=t[1]%360*y,O()):[g*v,d*v]},j.rotate=function(t){return arguments.length?(m=t[0]%360*y,E=t[1]%360*y,b=t.length>2?t[2]%360*y:0,O()):[m*v,E*v,b*v]},j.angle=function(t){return arguments.length?(S=t%360*y,O()):S*v},j.precision=function(t){return arguments.length?(u=Qn(a,P=t*t),A()):C(P)},j.fitExtent=function(t,n){return Un(j,t,n)},j.fitSize=function(t,n){return Xn(j,t,n)},j.fitWidth=function(t,n){return Yn(j,t,n)},j.fitHeight=function(t,n){return Zn(j,t,n)},function(){return n=t.apply(this,arguments),j.invert=n.invert&&N,O()}}function ee(t){var n=0,e=h/3,r=ne(t),i=r(n,e);return i.parallels=function(t){return arguments.length?r(n=t[0]*y,e=t[1]*y):[n*v,e*v]},i}function re(t,n){var e=P(t),r=(e+P(n))/2;if(m(r)<s)return function(t){var n=S(t);function e(t,e){return[t*n,P(e)/n]}return e.invert=function(t,e){return[t/n,A(e*n)]},e}(t);var i=1+e*(2*r-e),o=C(i)/r;function u(t,n){var e=C(i-2*r*P(n))/r;return[e*P(t*=r),o-e*S(t)]}return u.invert=function(t,n){var e=o-n;return[b(t,m(e))/r*j(e),A((i-(t*t+e*e)*r*r)/(2*r))]},u}function ie(){return ee(re).scale(155.424).center([0,33.6442])}function oe(){return ie().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function ue(t){return function(n,e){var r=S(n),i=S(e),o=t(r*i);return[o*i*P(n),o*P(e)]}}function ae(t){return function(n,e){var r=C(n*n+e*e),i=t(r),o=P(i),u=S(i);return[b(n*o,r*u),A(r&&e*o/r)]}}var ce=ue(function(t){return C(2/(1+t))});ce.invert=ae(function(t){return 2*A(t/2)});var le=ue(function(t){return(t=O(t))&&t/P(t)});function se(t,n){return[t,_(N((p+n)/2))]}function fe(t){var n,e,r,i=te(t),o=i.center,u=i.scale,a=i.translate,c=i.clipExtent,l=null;function s(){var o=h*u(),a=i(function(t){function n(n){return(n=t(n[0]*y,n[1]*y))[0]*=v,n[1]*=v,n}return t=Z(t[0]*y,t[1]*y,t.length>2?t[2]*y:0),n.invert=function(n){return(n=t.invert(n[0]*y,n[1]*y))[0]*=v,n[1]*=v,n},n}(i.rotate()).invert([0,0]));return c(null==l?[[a[0]-o,a[1]-o],[a[0]+o,a[1]+o]]:t===se?[[Math.max(a[0]-o,l),n],[Math.min(a[0]+o,e),r]]:[[l,Math.max(a[1]-o,n)],[e,Math.min(a[1]+o,r)]])}return i.scale=function(t){return arguments.length?(u(t),s()):u()},i.translate=function(t){return arguments.length?(a(t),s()):a()},i.center=function(t){return arguments.length?(o(t),s()):o()},i.clipExtent=function(t){return arguments.length?(null==t?l=n=e=r=null:(l=+t[0][0],n=+t[0][1],e=+t[1][0],r=+t[1][1]),s()):null==l?null:[[l,n],[e,r]]},s()}function he(t){return N((p+t)/2)}function pe(t,n){var e=S(t),r=t===n?P(t):_(e/S(n))/_(he(n)/he(t)),i=e*w(he(t),r)/r;if(!r)return se;function o(t,n){i>0?n<-p+s&&(n=-p+s):n>p-s&&(n=p-s);var e=i/w(he(n),r);return[e*P(r*t),i-e*S(r*t)]}return o.invert=function(t,n){var e=i-n,o=j(r)*C(t*t+e*e);return[b(t,m(e))/r*j(e),2*E(w(i/o,1/r))-p]},o}function ge(t,n){return[t,n]}function de(t,n){var e=S(t),r=t===n?P(t):(e-S(n))/(n-t),i=e/r+t;if(m(r)<s)return ge;function o(t,n){var e=i-n,o=r*t;return[e*P(o),i-e*S(o)]}return o.invert=function(t,n){var e=i-n;return[b(t,m(e))/r*j(e),i-j(r)*C(t*t+e*e)]},o}le.invert=ae(function(t){return t}),se.invert=function(t,n){return[t,2*E(M(n))-p]},ge.invert=ge;var ve=1.340264,ye=-.081106,me=893e-6,Ee=.003796,be=C(3)/2;function Se(t,n){var e=A(be*P(n)),r=e*e,i=r*r*r;return[t*S(e)/(be*(ve+3*ye*r+i*(7*me+9*Ee*r))),e*(ve+ye*r+i*(me+Ee*r))]}function xe(t,n){var e=S(n),r=S(t)*e;return[e*P(t)/r,P(n)/r]}function Me(t,n){var e=n*n,r=e*e;return[t*(.8707-.131979*e+r*(r*(.003971*e-.001529*r)-.013791)),n*(1.007226+e*(.015085+r*(.028874*e-.044475-.005916*r)))]}function _e(t,n){return[S(n)*P(t),P(n)]}function we(t,n){var e=S(n),r=1+S(t)*e;return[e*P(t)/r,P(n)/r]}function Pe(t,n){return[_(N((p+n)/2)),-t]}Se.invert=function(t,n){for(var e,r=n,i=r*r,o=i*i*i,u=0;u<12&&(o=(i=(r-=e=(r*(ve+ye*i+o*(me+Ee*i))-n)/(ve+3*ye*i+o*(7*me+9*Ee*i)))*r)*i*i,!(m(e)<f));++u);return[be*t*(ve+3*ye*i+o*(7*me+9*Ee*i))/S(r),A(P(r)/be)]},xe.invert=ae(E),Me.invert=function(t,n){var e,r=n,i=25;do{var o=r*r,u=o*o;r-=e=(r*(1.007226+o*(.015085+u*(.028874*o-.044475-.005916*u)))-n)/(1.007226+o*(.045255+u*(.259866*o-.311325-.005916*11*u)))}while(m(e)>s&&--i>0);return[t/(.8707+(o=r*r)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979)),r]},_e.invert=ae(A),we.invert=ae(function(t){return 2*E(t)}),Pe.invert=function(t,n){return[-n,2*E(M(t))-p]};var je={outlineBackgroundColor:null,outlineBorderColor:n.defaults.global.defaultColor,outlineBorderWidth:0,graticuleBorderColor:"#CCCCCC",graticuleBorderWidth:0};n.defaults.global.elements.geoFeature=i({},n.defaults.global.elements.rectangle,{},je);var Ce=n.elements.GeoFeature=n.Element.extend({inRange:function(t,n){var e,r,i=this.getBounds(),o=(Number.isNaN(t)||t>=i.x&&t<=i.x2)&&(Number.isNaN(n)||n>=i.y&&n<=i.y2),u=this._xScale.geoPath.projection();if(o&&!Number.isNaN(t)&&!Number.isNaN(n)&&"function"==typeof u.invert){var a=u.invert([t,n]);return a&&(e=this.feature,r=a,(e&&At.hasOwnProperty(e.type)?At[e.type]:Gt)(e,r))}return o},inLabelRange:function(t,n){return this.inRange(t,n)},inXRange:function(t){return this.inRange(t,NaN)},inYRange:function(t){return this.inRange(NaN,t)},getCenterPoint:function(){if(this.cache&&this.cache.center)return this.cache.center;var t=this._xScale.geoPath.centroid(this.feature),n={x:t[0],y:t[1]};return this.cache=i({},this.cache||{},{center:n}),n},getBounds:function(){if(this.cache&&this.cache.bounds)return this.cache.bounds;var t=o(this._xScale.geoPath.bounds(this.feature),2),n=o(t[0],2),e=n[0],r=n[1],u=o(t[1],2),a=u[0],c=u[1],l={x:e,x2:a,y:r,y2:c,width:a-e,height:c-r};return this.cache=i({},this.cache||{},{bounds:l}),l},getArea:function(){if(this.cache&&this.cache.area)return this.cache.area;var t=this._xScale.geoPath.area(this.feature);return this.cache=i({},this.cache||{},{area:t}),t},tooltipPosition:function(){return this.getCenterPoint()},draw:function(){if(this.feature){var t=this._view,n=this._chart.ctx;n.save(),n.beginPath(),this._xScale.geoPath.context(n)(this.feature),t.backgroundColor&&(n.fillStyle=t.backgroundColor,n.fill()),t.borderColor&&(n.strokeStyle=t.borderColor,n.lineWidth=t.borderWidth,n.stroke()),n.restore()}}}),Ne=n.helpers.configMerge(n.defaults.global,{showOutline:!1,showGraticule:!1,clipMap:!0,animation:!1,scale:{type:"projection",id:"scale",display:!1}}),Oe=n.DatasetController.prototype,Ae=n.DatasetController.extend({datasetElementType:n.elements.GeoFeature,getProjectionScale:function(){return this.getScaleForId("scale")},linkScales:function(){var t=this.getMeta();t.xAxisID="scale",t.yAxisID="scale",this.getProjectionScale().computeBounds(this.resolveOutline())},showOutline:function(){return n.helpers.valueOrDefault(this.getDataset().showOutline,this.chart.options.showOutline)},clipMap:function(){return n.helpers.valueOrDefault(this.getDataset().clipMap,this.chart.options.clipMap)},getGraticule:function(){return n.helpers.valueOrDefault(this.getDataset().showGraticule,this.chart.options.showGraticule)},update:function(t){var n=this;Oe.update.call(this,t);var e=this.getProjectionScale().updateBounds();if(this.showOutline()){var r=this.getMeta().dataset;this.updateGeoFeatureElement(r,-1,t),e&&delete r.cache}this.getGraticule()&&(this.getMeta().graticule=this.resolveGeoFeatureOptions({},-1,t)),this.getMeta().data.forEach(function(r,i){n.updateElement(r,i,t),e&&delete r.cache})},resolveOutline:function(){var t=this.getDataset().outline||{type:"Sphere"};return Array.isArray(t)?{type:"FeatureCollection",features:t}:t},updateElement:function(){},updateGeoFeatureElement:function(t,n,e){var r=this.getDataset(),i=this.getMeta();t.feature=n<0?this.resolveOutline():r.data[n].feature,t._xScale=this.getScaleForId(i.xAxisID),t._yScale=this.getScaleForId(i.yAxisID),t._datasetIndex=this.index,t._index=n,t._model=this.resolveGeoFeatureOptions(t,n,e);var o=t.getCenterPoint();t._model.x=o.x,t._model.y=o.y,t.pivot()},resolveGeoFeatureOptions:function(t,e,r){var i=this.chart,o=this.getDataset(),u=t.custom||{},a=i.options.elements.geoFeature,c={chart:i,dataIndex:e,dataset:o,datasetIndex:this.index,reset:r},l={};return["backgroundColor","borderColor","borderWidth","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth"].forEach(function(t){var r;if(e<0){var i="outline".concat(t.charAt(0).toUpperCase()).concat(t.slice(1));r=[u[i],o[i],a[i]]}else r=[u[t],o[t],a[t]];l[t]=n.helpers.options.resolve(r,c,e)}),l},transition:function(t){Oe.transition.call(this,t)},showGraticule:function(){var t=this.getGraticule();if(t){var n=this.chart.ctx,e=this.getProjectionScale().geoPath.context(n);if(n.save(),n.beginPath(),!0===t)e(zt()());else{var r=zt();t.stepMajor&&r.stepMajor(t.stepMajor),t.stepMinor&&r.stepMinor(t.stepMinor),e(r)}var i=this.getMeta().graticule;n.strokeStyle=i.borderColor,n.lineWidth=i.borderWidth,n.stroke(),n.restore()}},draw:function(){var t=this.chart,e=this.clipMap(),r=!1;!0!==e&&"outline"!==e&&"outline+graticule"!==e||(r=!0,n.helpers.canvas.clipArea(t.ctx,t.chartArea)),this.showOutline()&&this.getMeta().dataset.draw(),!0===e||"graticule"===e||"outline+graticule"===e?r||n.helpers.canvas.clipArea(t.ctx,t.chartArea):r&&(r=!1,n.helpers.canvas.unclipArea(t.ctx)),this.showGraticule(),!0===e||"items"===e?r||n.helpers.canvas.clipArea(t.ctx,t.chartArea):r&&(r=!1,n.helpers.canvas.unclipArea(t.ctx)),this.getMeta().data.forEach(function(t){return t.draw()}),r&&(r=!1,n.helpers.canvas.unclipArea(t.ctx))}});n.defaults.choropleth=n.helpers.configMerge(Ne,{hover:{mode:"single"},tooltips:{callbacks:{title:function(){return""},label:function(t,n){return n.labels[t.index]}}}});var ke=Ae.prototype,Ge=n.controllers.choropleth=Ae.extend({dataElementType:n.elements.GeoFeature,updateElement:function(t,n,e){ke.updateElement.call(this,t,n,e),this.updateGeoFeatureElement(t,n,e)}});n.defaults.bubbleMap=n.helpers.configMerge(Ne,{showOutline:!0,clipMap:"outline+graticule",hover:{mode:"single"},tooltips:{callbacks:{title:function(){return""},label:function(t,n){var e=n.labels[t.index]||"",r=n.datasets[t.datasetIndex].data[t.index];return"".concat(e,": ").concat(r.r)}}}});var Fe=Ae.prototype,De=n.controllers.bubble.prototype,Be=n.controllers.bubbleMap=Ae.extend({dataElementType:n.elements.Point,_dataElementOptions:De._dataElementOptions,updateElement:function(t,n,e){Fe.updateElement.apply(this,arguments);var r=this.getMeta(),i=t.custom||{},u=this.getDataset().data[n],a=o(this.getProjectionScale().projection([null==u.longitude?u.x:u.longitude,null==u.latitude?u.y:u.latitude]),2),c=a[0],l=a[1];t._xScale=this.getScaleForId(r.xAxisID),t._yScale=this.getScaleForId(r.yAxisID),t._datasetIndex=this.index,t._index=n;var s=(De._resolveElementOptions||De._resolveDataElementOptions).call(this,t,n);t._options=s,t._model={backgroundColor:s.backgroundColor,borderColor:s.borderColor,borderWidth:s.borderWidth,hitRadius:s.hitRadius,pointStyle:s.pointStyle,rotation:s.rotation,radius:e?0:s.radius,skip:i.skip||isNaN(c)||isNaN(l),x:c,y:l},t.pivot()},setHoverStyle:function(t){De.setHoverStyle.call(this,t)}}),Ie={geoAzimuthalEqualArea:function(){return te(ce).scale(124.75).clipAngle(179.999)},geoAzimuthalEquidistant:function(){return te(le).scale(79.4188).clipAngle(179.999)},geoGnomonic:function(){return te(xe).scale(144.049).clipAngle(60)},geoOrthographic:function(){return te(_e).scale(249.5).clipAngle(90+s)},geoStereographic:function(){return te(we).scale(250).clipAngle(142)},geoEqualEarth:function(){return te(Se).scale(177.158)},geoAlbers:oe,geoAlbersUsa:function(){var t,n,e,r,i,o,u=oe(),a=ie().rotate([154,0]).center([-2,58.5]).parallels([55,65]),c=ie().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,n){o=[t,n]}};function f(t){var n=t[0],u=t[1];return o=null,e.point(n,u),o||(r.point(n,u),o)||(i.point(n,u),o)}function h(){return t=n=null,f}return f.invert=function(t){var n=u.scale(),e=u.translate(),r=(t[0]-e[0])/n,i=(t[1]-e[1])/n;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?a:i>=.166&&i<.234&&r>=-.214&&r<-.115?c:u).invert(t)},f.stream=function(e){return t&&n===e?t:(r=[u.stream(n=e),a.stream(e),c.stream(e)],i=r.length,t={point:function(t,n){for(var e=-1;++e<i;)r[e].point(t,n)},sphere:function(){for(var t=-1;++t<i;)r[t].sphere()},lineStart:function(){for(var t=-1;++t<i;)r[t].lineStart()},lineEnd:function(){for(var t=-1;++t<i;)r[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<i;)r[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<i;)r[t].polygonEnd()}});var r,i},f.precision=function(t){return arguments.length?(u.precision(t),a.precision(t),c.precision(t),h()):u.precision()},f.scale=function(t){return arguments.length?(u.scale(t),a.scale(.35*t),c.scale(t),f.translate(u.translate())):u.scale()},f.translate=function(t){if(!arguments.length)return u.translate();var n=u.scale(),o=+t[0],f=+t[1];return e=u.translate(t).clipExtent([[o-.455*n,f-.238*n],[o+.455*n,f+.238*n]]).stream(l),r=a.translate([o-.307*n,f+.201*n]).clipExtent([[o-.425*n+s,f+.12*n+s],[o-.214*n-s,f+.234*n-s]]).stream(l),i=c.translate([o-.205*n,f+.212*n]).clipExtent([[o-.214*n+s,f+.166*n+s],[o-.115*n-s,f+.234*n-s]]).stream(l),h()},f.fitExtent=function(t,n){return Un(f,t,n)},f.fitSize=function(t,n){return Xn(f,t,n)},f.fitWidth=function(t,n){return Yn(f,t,n)},f.fitHeight=function(t,n){return Zn(f,t,n)},f.scale(1070)},geoConicConformal:function(){return ee(pe).scale(109.5).parallels([30,30])},geoConicEqualArea:ie,geoConicEquidistant:function(){return ee(de).scale(131.154).center([0,13.9389])},geoEquirectangular:function(){return te(ge).scale(152.63)},geoMercator:function(){return fe(se).scale(961/d)},geoTransverseMercator:function(){var t=fe(Pe),n=t.center,e=t.rotate;return t.center=function(t){return arguments.length?n([-t[1],t[0]]):[(t=n())[1],-t[0]]},t.rotate=function(t){return arguments.length?e([t[0],t[1],t.length>2?t[2]+90:90]):[(t=e())[0],t[1],t[2]-90]},e([0,0,90]).scale(159.155)},geoNaturalEarth1:function(){return te(Me).scale(175.295)}};Object.keys(Ie).forEach(function(t){Ie["".concat(t.charAt(3).toLowerCase()).concat(t.slice(4))]=Ie[t]});var Le=n.Scale.prototype,Re=n.Scale.extend({ticks:[],initialize:function(){Le.initialize.call(this),this.geoPath=zn(),"string"==typeof this.options.projection&&"function"==typeof Ie[this.options.projection]?this.projection=Ie[this.options.projection]():this.projection=this.options.projection,this.geoPath.projection(this.projection)},computeBounds:function(t){var n=zn(this.projection.fitWidth(1e3,t)).bounds(t),e=Math.ceil(n[1][1]-n[0][1]),r=Math.ceil(n[1][0]-n[0][0]),i=this.projection.translate();this.outlineBounds={width:r,height:e,aspectRatio:r/e,refScale:this.projection.scale(),refX:i[0],refY:i[1]}},updateBounds:function(){var t=this.chart.chartArea,n=this.outlineBounds,e=t.right-t.left,r=t.bottom-t.top,i=this.oldChartBounds;this.oldChartBounds={chartWidth:e,chartHeight:r};var o=Math.min(e/n.width,r/n.height),u=.5*(e-n.width*o),a=.5*(r-n.height*o);return this.projection.scale(n.refScale*o).translate([o*n.refX+u,o*n.refY+a]),!i||i.chartWidth!==this.oldChartBounds.chartWidth||i.chartHeight!==this.oldChartBounds.chartHeight}});function We(t){return t}function ze(t){if(null==t)return We;var n,e,r=t.scale[0],i=t.scale[1],o=t.translate[0],u=t.translate[1];return function(t,a){a||(n=e=0);var c=2,l=t.length,s=new Array(l);for(s[0]=(n+=t[0])*r+o,s[1]=(e+=t[1])*i+u;c<l;)s[c]=t[c],++c;return s}}function qe(t){var n,e=ze(t.transform),r=1/0,i=r,o=-r,u=-r;function a(t){(t=e(t))[0]<r&&(r=t[0]),t[0]>o&&(o=t[0]),t[1]<i&&(i=t[1]),t[1]>u&&(u=t[1])}function c(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(c);break;case"Point":a(t.coordinates);break;case"MultiPoint":t.coordinates.forEach(a)}}for(n in t.arcs.forEach(function(t){for(var n,a=-1,c=t.length;++a<c;)(n=e(t[a],a))[0]<r&&(r=n[0]),n[0]>o&&(o=n[0]),n[1]<i&&(i=n[1]),n[1]>u&&(u=n[1])}),t.objects)c(t.objects[n]);return[r,i,o,u]}function Te(t,n){var e=n.id,r=n.bbox,i=null==n.properties?{}:n.properties,o=He(t,n);return null==e&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:e,properties:i,geometry:o}:{type:"Feature",id:e,bbox:r,properties:i,geometry:o}}function He(t,n){var e=ze(t.transform),r=t.arcs;function i(t,n){n.length&&n.pop();for(var i=r[t<0?~t:t],o=0,u=i.length;o<u;++o)n.push(e(i[o],o));t<0&&function(t,n){for(var e,r=t.length,i=r-n;i<--r;)e=t[i],t[i++]=t[r],t[r]=e}(n,u)}function o(t){return e(t)}function u(t){for(var n=[],e=0,r=t.length;e<r;++e)i(t[e],n);return n.length<2&&n.push(n[0]),n}function a(t){for(var n=u(t);n.length<4;)n.push(n[0]);return n}function c(t){return t.map(a)}return function t(n){var e,r=n.type;switch(r){case"GeometryCollection":return{type:r,geometries:n.geometries.map(t)};case"Point":e=o(n.coordinates);break;case"MultiPoint":e=n.coordinates.map(o);break;case"LineString":e=u(n.arcs);break;case"MultiLineString":e=n.arcs.map(u);break;case"Polygon":e=c(n.arcs);break;case"MultiPolygon":e=n.arcs.map(c);break;default:return null}return{type:r,coordinates:e}}(n)}function Ue(t,n){var e={},r={},i={},o=[],u=-1;function a(t,n){for(var r in t){var i=t[r];delete n[i.start],delete i.start,delete i.end,i.forEach(function(t){e[t<0?~t:t]=1}),o.push(i)}}return n.forEach(function(e,r){var i,o=t.arcs[e<0?~e:e];o.length<3&&!o[1][0]&&!o[1][1]&&(i=n[++u],n[u]=e,n[r]=i)}),n.forEach(function(n){var e,o,u=function(n){var e,r=t.arcs[n<0?~n:n],i=r[0];t.transform?(e=[0,0],r.forEach(function(t){e[0]+=t[0],e[1]+=t[1]})):e=r[r.length-1];return n<0?[e,i]:[i,e]}(n),a=u[0],c=u[1];if(e=i[a])if(delete i[e.end],e.push(n),e.end=c,o=r[c]){delete r[o.start];var l=o===e?e:e.concat(o);r[l.start=e.start]=i[l.end=o.end]=l}else r[e.start]=i[e.end]=e;else if(e=r[c])if(delete r[e.start],e.unshift(n),e.start=a,o=i[a]){delete i[o.end];var s=o===e?e:o.concat(e);r[s.start=o.start]=i[s.end=e.end]=s}else r[e.start]=i[e.end]=e;else r[(e=[n]).start=a]=i[e.end=c]=e}),a(i,r),a(r,i),n.forEach(function(t){e[t<0?~t:t]||o.push([t])}),o}function Xe(t,n,e){var r,i,o;if(arguments.length>1)r=function(t,n,e){var r,i=[],o=[];function u(t){var n=t<0?~t:t;(o[n]||(o[n]=[])).push({i:t,g:r})}function a(t){t.forEach(u)}function c(t){t.forEach(a)}return function t(n){switch(r=n,n.type){case"GeometryCollection":n.geometries.forEach(t);break;case"LineString":a(n.arcs);break;case"MultiLineString":case"Polygon":c(n.arcs);break;case"MultiPolygon":n.arcs.forEach(c)}}(n),o.forEach(null==e?function(t){i.push(t[0].i)}:function(t){e(t[0].g,t[t.length-1].g)&&i.push(t[0].i)}),i}(0,n,e);else for(i=0,r=new Array(o=t.arcs.length);i<o;++i)r[i]=i;return{type:"MultiLineString",arcs:Ue(t,r)}}function Ye(t,n){var e={},r=[],i=[];function o(t){t.forEach(function(n){n.forEach(function(n){(e[n=n<0?~n:n]||(e[n]=[])).push(t)})}),r.push(t)}function u(n){return function(t){for(var n,e=-1,r=t.length,i=t[r-1],o=0;++e<r;)n=i,i=t[e],o+=n[0]*i[1]-n[1]*i[0];return Math.abs(o)}(He(t,{type:"Polygon",arcs:[n]}).coordinates[0])}return n.forEach(function t(n){switch(n.type){case"GeometryCollection":n.geometries.forEach(t);break;case"Polygon":o(n.arcs);break;case"MultiPolygon":n.arcs.forEach(o)}}),r.forEach(function(t){if(!t._){var n=[],r=[t];for(t._=1,i.push(n);t=r.pop();)n.push(t),t.forEach(function(t){t.forEach(function(t){e[t<0?~t:t].forEach(function(t){t._||(t._=1,r.push(t))})})})}}),r.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:i.map(function(n){var r,i=[];if(n.forEach(function(t){t.forEach(function(t){t.forEach(function(t){e[t<0?~t:t].length<2&&i.push(t)})})}),(r=(i=Ue(t,i)).length)>1)for(var o,a,c=1,l=u(i[0]);c<r;++c)(o=u(i[c]))>l&&(a=i[0],i[0]=i[c],i[c]=a,l=o);return i}).filter(function(t){return t.length>0})}}function Ze(t,n){for(var e=0,r=t.length;e<r;){var i=e+r>>>1;t[i]<n?e=i+1:r=i}return e}function Je(t){if(null==t)return We;var n,e,r=t.scale[0],i=t.scale[1],o=t.translate[0],u=t.translate[1];return function(t,a){a||(n=e=0);var c=2,l=t.length,s=new Array(l),f=Math.round((t[0]-o)/r),h=Math.round((t[1]-u)/i);for(s[0]=f-n,n=f,s[1]=h-e,e=h;c<l;)s[c]=t[c],++c;return s}}n.scaleService.registerScaleType("projection",Re,{projection:"albersUsa"});var Ke=Object.freeze({bbox:qe,feature:function(t,n){return"GeometryCollection"===n.type?{type:"FeatureCollection",features:n.geometries.map(function(n){return Te(t,n)})}:Te(t,n)},mesh:function(t){return He(t,Xe.apply(this,arguments))},meshArcs:Xe,merge:function(t){return He(t,Ye.apply(this,arguments))},mergeArcs:Ye,neighbors:function(t){var n={},e=t.map(function(){return[]});function r(t,e){t.forEach(function(t){t<0&&(t=~t);var r=n[t];r?r.push(e):n[t]=[e]})}function i(t,n){t.forEach(function(t){r(t,n)})}var o={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(t,n){t.forEach(function(t){i(t,n)})}};for(var u in t.forEach(function t(n,e){"GeometryCollection"===n.type?n.geometries.forEach(function(n){t(n,e)}):n.type in o&&o[n.type](n.arcs,e)}),n)for(var a=n[u],c=a.length,l=0;l<c;++l)for(var s=l+1;s<c;++s){var f,h=a[l],p=a[s];(f=e[h])[u=Ze(f,p)]!==p&&f.splice(u,0,p),(f=e[p])[u=Ze(f,h)]!==h&&f.splice(u,0,h)}return e},quantize:function(t,n){if(t.transform)throw new Error("already quantized");if(n&&n.scale)a=t.bbox;else{if(!((e=Math.floor(n))>=2))throw new Error("n must be ≥2");var e,r=(a=t.bbox||qe(t))[0],i=a[1],o=a[2],u=a[3];n={scale:[o-r?(o-r)/(e-1):1,u-i?(u-i)/(e-1):1],translate:[r,i]}}var a,c,l=Je(n),s=t.objects,f={};function h(t){return l(t)}function p(t){var n;switch(t.type){case"GeometryCollection":n={type:"GeometryCollection",geometries:t.geometries.map(p)};break;case"Point":n={type:"Point",coordinates:h(t.coordinates)};break;case"MultiPoint":n={type:"MultiPoint",coordinates:t.coordinates.map(h)};break;default:return t}return null!=t.id&&(n.id=t.id),null!=t.bbox&&(n.bbox=t.bbox),null!=t.properties&&(n.properties=t.properties),n}for(c in s)f[c]=p(s[c]);return{type:"Topology",bbox:a,transform:n,objects:f,arcs:t.arcs.map(function(t){var n,e=0,r=1,i=t.length,o=new Array(i);for(o[0]=l(t[0],0);++e<i;)((n=l(t[e],e))[0]||n[1])&&(o[r++]=n);return 1===r&&(o[r++]=[0,0]),o.length=r,o})}},transform:ze,untransform:Je});t.BubbleMap=Be,t.Choropleth=Ge,t.Geo=Ae,t.GeoFeature=Ce,t.ProjectionScale=Re,t.geoDefaults=Ne,t.topojson=Ke,Object.defineProperty(t,"__esModule",{value:!0})});